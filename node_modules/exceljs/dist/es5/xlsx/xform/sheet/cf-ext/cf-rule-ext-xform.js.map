{"version":3,"sources":["../../../../../../lib/xlsx/xform/sheet/cf-ext/cf-rule-ext-xform.js"],"names":["uuid","require","BaseXform","CompositeXform","DatabarExtXform","IconSetExtXform","extIcons","CfRuleExtXform","map","databarXform","iconSetXform","model","isExt","x14Id","v4","toUpperCase","xmlStream","type","renderDataBar","renderIconSet","openNode","tag","id","render","closeNode","priority","attributes","toIntValue","name","parser","Object","assign","rule","custom","iconSet","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACA,IAAMC,SAAS,GAAGD,OAAO,CAAC,kBAAD,CAAzB;;AACA,IAAME,cAAc,GAAGF,OAAO,CAAC,uBAAD,CAA9B;;AAEA,IAAMG,eAAe,GAAGH,OAAO,CAAC,qBAAD,CAA/B;;AACA,IAAMI,eAAe,GAAGJ,OAAO,CAAC,sBAAD,CAA/B;;AAEA,IAAMK,QAAQ,GAAG;AACf,gBAAc,IADC;AAEf,YAAU,IAFK;AAGf,YAAU;AAHK,CAAjB;;IAMMC,c;;;;;AACJ,4BAAc;AAAA;;AAAA;;AACZ;AAEA,UAAKC,GAAL,GAAW;AACT,qBAAgB,MAAKC,YAAL,GAAoB,IAAIL,eAAJ,EAD3B;AAET,qBAAgB,MAAKM,YAAL,GAAoB,IAAIL,eAAJ;AAF3B,KAAX;AAHY;AAOb;;;;4BAmBOM,K,EAAO;AACb,UAAIJ,cAAc,CAACK,KAAf,CAAqBD,KAArB,CAAJ,EAAiC;AAC/BA,QAAAA,KAAK,CAACE,KAAN,GAAc,WAAIb,IAAI,CAACc,EAAL,EAAJ,OAAiBC,WAAjB,EAAd;AACD;AACF;;;2BAEMC,S,EAAWL,K,EAAO;AACvB,UAAI,CAACJ,cAAc,CAACK,KAAf,CAAqBD,KAArB,CAAL,EAAkC;AAChC;AACD;;AAED,cAAQA,KAAK,CAACM,IAAd;AACE,aAAK,SAAL;AACE,eAAKC,aAAL,CAAmBF,SAAnB,EAA8BL,KAA9B;AACA;;AACF,aAAK,SAAL;AACE,eAAKQ,aAAL,CAAmBH,SAAnB,EAA8BL,KAA9B;AACA;AANJ;AAQD;;;kCAEaK,S,EAAWL,K,EAAO;AAC9BK,MAAAA,SAAS,CAACI,QAAV,CAAmB,KAAKC,GAAxB,EAA6B;AAC3BJ,QAAAA,IAAI,EAAE,SADqB;AAE3BK,QAAAA,EAAE,EAAEX,KAAK,CAACE;AAFiB,OAA7B;AAKA,WAAKJ,YAAL,CAAkBc,MAAlB,CAAyBP,SAAzB,EAAoCL,KAApC;AAEAK,MAAAA,SAAS,CAACQ,SAAV;AACD;;;kCAEaR,S,EAAWL,K,EAAO;AAC9BK,MAAAA,SAAS,CAACI,QAAV,CAAmB,KAAKC,GAAxB,EAA6B;AAC3BJ,QAAAA,IAAI,EAAE,SADqB;AAE3BQ,QAAAA,QAAQ,EAAEd,KAAK,CAACc,QAFW;AAG3BH,QAAAA,EAAE,EAAEX,KAAK,CAACE,KAAN,eAAmBb,IAAI,CAACc,EAAL,EAAnB;AAHuB,OAA7B;AAMA,WAAKJ,YAAL,CAAkBa,MAAlB,CAAyBP,SAAzB,EAAoCL,KAApC;AAEAK,MAAAA,SAAS,CAACQ,SAAV;AACD;;;yCAE4B;AAAA,UAAbE,UAAa,QAAbA,UAAa;AAC3B,aAAO;AACLT,QAAAA,IAAI,EAAES,UAAU,CAACT,IADZ;AAELJ,QAAAA,KAAK,EAAEa,UAAU,CAACJ,EAFb;AAGLG,QAAAA,QAAQ,EAAEvB,SAAS,CAACyB,UAAV,CAAqBD,UAAU,CAACD,QAAhC;AAHL,OAAP;AAKD;;;kCAEaG,I,EAAMC,M,EAAQ;AAC1BC,MAAAA,MAAM,CAACC,MAAP,CAAc,KAAKpB,KAAnB,EAA0BkB,MAAM,CAAClB,KAAjC;AACD;;;wBAvES;AACR,aAAO,YAAP;AACD;;;0BAEYqB,I,EAAM;AACjB;AACA,UAAIA,IAAI,CAACf,IAAL,KAAc,SAAlB,EAA6B;AAC3B,eAAOb,eAAe,CAACQ,KAAhB,CAAsBoB,IAAtB,CAAP;AACD;;AACD,UAAIA,IAAI,CAACf,IAAL,KAAc,SAAlB,EAA6B;AAC3B,YAAIe,IAAI,CAACC,MAAL,IAAe3B,QAAQ,CAAC0B,IAAI,CAACE,OAAN,CAA3B,EAA2C;AACzC,iBAAO,IAAP;AACD;AACF;;AACD,aAAO,KAAP;AACD;;;;EAzB0B/B,c;;AAoF7BgC,MAAM,CAACC,OAAP,GAAiB7B,cAAjB","sourcesContent":["const uuid = require('uuid');\r\nconst BaseXform = require('../../base-xform');\r\nconst CompositeXform = require('../../composite-xform');\r\n\r\nconst DatabarExtXform = require('./databar-ext-xform');\r\nconst IconSetExtXform = require('./icon-set-ext-xform');\r\n\r\nconst extIcons = {\r\n  '3Triangles': true,\r\n  '3Stars': true,\r\n  '5Boxes': true,\r\n};\r\n\r\nclass CfRuleExtXform extends CompositeXform {\r\n  constructor() {\r\n    super();\r\n\r\n    this.map = {\r\n      'x14:dataBar': (this.databarXform = new DatabarExtXform()),\r\n      'x14:iconSet': (this.iconSetXform = new IconSetExtXform()),\r\n    };\r\n  }\r\n\r\n  get tag() {\r\n    return 'x14:cfRule';\r\n  }\r\n\r\n  static isExt(rule) {\r\n    // is this rule primitive?\r\n    if (rule.type === 'dataBar') {\r\n      return DatabarExtXform.isExt(rule);\r\n    }\r\n    if (rule.type === 'iconSet') {\r\n      if (rule.custom || extIcons[rule.iconSet]) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  prepare(model) {\r\n    if (CfRuleExtXform.isExt(model)) {\r\n      model.x14Id = `{${uuid.v4()}}`.toUpperCase();\r\n    }\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    if (!CfRuleExtXform.isExt(model)) {\r\n      return;\r\n    }\r\n\r\n    switch (model.type) {\r\n      case 'dataBar':\r\n        this.renderDataBar(xmlStream, model);\r\n        break;\r\n      case 'iconSet':\r\n        this.renderIconSet(xmlStream, model);\r\n        break;\r\n    }\r\n  }\r\n\r\n  renderDataBar(xmlStream, model) {\r\n    xmlStream.openNode(this.tag, {\r\n      type: 'dataBar',\r\n      id: model.x14Id,\r\n    });\r\n\r\n    this.databarXform.render(xmlStream, model);\r\n\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  renderIconSet(xmlStream, model) {\r\n    xmlStream.openNode(this.tag, {\r\n      type: 'iconSet',\r\n      priority: model.priority,\r\n      id: model.x14Id || `{${uuid.v4()}}`,\r\n    });\r\n\r\n    this.iconSetXform.render(xmlStream, model);\r\n\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  createNewModel({attributes}) {\r\n    return {\r\n      type: attributes.type,\r\n      x14Id: attributes.id,\r\n      priority: BaseXform.toIntValue(attributes.priority),\r\n    };\r\n  }\r\n\r\n  onParserClose(name, parser) {\r\n    Object.assign(this.model, parser.model);\r\n  }\r\n}\r\n\r\nmodule.exports = CfRuleExtXform;\r\n"],"file":"cf-rule-ext-xform.js"}